<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>1ª Tech&Vida - Visitação de Projetos</title>
    <h3>Leia todos os QRCodes para ganhar o brinde!</h3>
    <link rel="stylesheet" href="styles.css">
</head>
<div class="container">
    <header>
        <!-- Logo no canto superior direito -->
        <img src="logo.png" alt="Logo" class="logo">
    </header>
<!DOCTYPE html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
   
    </head>
    <body>
    
        <h1>Feira Tech & Vida</h1>
        
        <head>
            <meta charset="UTF-8">
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
            <title>Escaneamento de QR Code com Barra de Progresso</title>
            <style>
                /* Estilo básico para centralizar o conteúdo */
                body {
                    font-family: Arial, sans-serif;
                    display: flex;
                    justify-content: center;
                    align-items: center;
                    flex-direction: column;
                    height: 100vh;
                    margin: 0;
                    background-color: #f0f0f0;
                }
        
                #video {
                    width: 100%;
                    max-width: 500px;
                    border: 2px solid #000;
                }
        
                #log {
                    margin-top: 20px;
                    font-size: 16px;
                    font-weight: bold;
                }
        
                #redirect-button {
                    display: none;
                    margin-top: 20px;
                    padding: 10px 20px;
                    background-color: #4CAF50;
                    color: white;
                    border: none;
                    cursor: pointer;
                }
        
                #redirect-button:hover {
                    background-color: #45a049;
                }
        
                /* Estilos para a barra de progresso */
                #progress-bar-container {
                    width: 100%;
                    max-width: 500px;
                    background-color: #ddd;
                    height: 20px;
                    margin-top: 20px;
                    border-radius: 10px;
                    overflow: hidden;
                }
        
                #progress-bar {
                    width: 0;
                    height: 100%;
                    background-color: #4CAF50;
                    text-align: center;
                    line-height: 20px;
                    color: white;
                    font-weight: bold;
                }
            </style>
        </head>
        <body>
        
            <div>
                <video id="video" autoplay playsinline></video>
                <div id="log">Escaneie o QR Code...</div>
                <button id="redirect-button" onclick="window.location.href='https://example.com';">Ir para o link</button>
                <!-- Barra de progresso -->
                <div id="progress-bar-container">
                    <div id="progress-bar">0%</div>
                </div>
            </div>
        
            <script src="https://cdn.jsdelivr.net/npm/jsqr/dist/jsQR.js"></script>
            <script>
                let scanning = false;  // Variável para verificar se o QR code foi lido
                let progress = 0;  // A variável que controla a progressão da barra
        
                // Função para iniciar a câmera
                function startCamera() {
                    if (scanning) return;  // Se já tiver escaneado, não faz nada
        
                    scanning = true;  // Marca que começamos a escanear
                    const video = document.getElementById('video');
                    const canvas = document.createElement('canvas');
                    const context = canvas.getContext('2d');
        
                    // Acesse a câmera traseira
                    navigator.mediaDevices.getUserMedia({
                        video: { facingMode: { exact: "environment" } }  // Garante o uso da câmera traseira
                    })
                    .then(stream => {
                        video.srcObject = stream;
                        video.setAttribute('playsinline', true); // Para que funcione no iPhone
                        video.play();
                        requestAnimationFrame(scanQRCode); // Inicia o processo de leitura do QR code
                    })
                    .catch(err => {
                        console.error("Erro ao acessar a câmera: ", err);
                        document.getElementById('log').textContent = "Erro ao acessar a câmera.";
                    });
                }
        
                // Função para escanear o QR code a cada quadro
                function scanQRCode() {
                    if (!scanning) return; // Se já leu o QR code, não faz mais nada
        
                    const video = document.getElementById('video');
                    const canvas = document.createElement('canvas');
                    const context = canvas.getContext('2d');
        
                    // Definir o tamanho do canvas para o tamanho do vídeo
                    canvas.width = video.videoWidth;
                    canvas.height = video.videoHeight;
        
                    // Desenhar o vídeo no canvas
                    context.drawImage(video, 0, 0, canvas.width, canvas.height);
        
                    // Obter a imagem do canvas como dados
                    const imageData = context.getImageData(0, 0, canvas.width, canvas.height);
                    const code = jsQR(imageData.data, canvas.width, canvas.height);
        
                    if (code) {
                        // QR code foi encontrado
                        handleQRCode(code);
                    } else {
                        // Continua escaneando se não encontrar nenhum QR code
                        requestAnimationFrame(scanQRCode);
                    }
                }
        
                // Função para tratar o QR code lido
                function handleQRCode(code) {
                    // Exibe o conteúdo do QR code no log
                    document.getElementById('log').textContent = `QR Code encontrado: ${code.data}`;
        
                    // Aumenta a barra de progresso a cada QR code lido
                    increaseProgress();
        
                    // Parar o stream de vídeo e interromper a leitura da câmera
                    stopCamera();
        
                    // Exibir o botão de redirecionamento
                    document.getElementById('redirect-button').style.display = 'inline-block';
                }
        
                // Função para aumentar a barra de progresso
                function increaseProgress() {
                    // Aumenta o progresso em 20% por cada QR Code lido (ajuste conforme necessário)
                    progress += 20;
                    if (progress > 100) progress = 100; // Limita a 100%
        
                    // Atualiza a barra de progresso
                    const progressBar = document.getElementById('progress-bar');
                    progressBar.style.width = progress + '%';
                    progressBar.textContent = progress + '%';
                }
        
                // Função para parar a câmera
                function stopCamera() {
                    const video = document.getElementById('video');
                    const stream = video.srcObject;
        
                    // Se o stream da câmera estiver ativo, pare a captura de vídeo
                    if (stream) {
                        const tracks = stream.getTracks();
                        tracks.forEach(track => track.stop());
                        video.srcObject = null;
                    }
        
                    scanning = false;  // Permitir escaneamento novamente, caso necessário
                }
        
                // Inicia a câmera quando a página carregar
                window.onload = startCamera;
            </script>
        
</html>